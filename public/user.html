<!DOCTYPE html>
<html lang="en">

<head>
  <title>Kullanıcı Sayfası &mdash;</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="adminUserPage/fonts/icomoon/style.css">
  <link rel="stylesheet" href="adminUserPage/css/bootstrap.min.css">
  <link rel="stylesheet" href="adminUserPage/css/magnific-popup.css">
  <link rel="stylesheet" href="adminUserPage/css/jquery-ui.css">
  <link rel="stylesheet" href="adminUserPage/css/owl.carousel.min.css">
  <link rel="stylesheet" href="adminUserPage/css/owl.theme.default.min.css">
  <link rel="stylesheet" href="adminUserPage/css/bootstrap-datepicker.css">
  <link rel="stylesheet" href="adminUserPage/fonts/flaticon/font/flaticon.css">
  <link rel="stylesheet" href="adminUserPage/css/aos.css">

  <link rel="stylesheet" href="adminUserPage/css/style.css">
</head>

<body>

  <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>

    <header class="site-navbar py-3" role="banner">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-11 col-xl-2" style="left:30%">
            <h1 class="mb-0"><p href="index.html" class="text-white h2 mb-0" style="font-family:Segoe UI Symbol; font-size: 120%;">Kullanıcı<span
                  class="text-primary" id="addUserName">Sayfası</span> </p></h1>
          </div>
        </div>
      </div>
  </div>
  </header>

  <div class="site-section site-hero">
    <div class="container">
      <div class="row align-items-center"
        style="margin:0px; width:30%;height: 10em; padding: 0px;height: 100px;position:absolute; left: 10px">
        <div class="col-md-10"style="margin-top: -5%">
          <!-- <form id="userSearch" method="POST" action="/userSearch" enctype="multipart/form-data">  -->
          <form id="userSearch">
            <h1 class="d-block mb-4" data-aos="fade-up" data-aos-delay="200"style="font-family:Segoe UI Symbol;" style="font-size:10px;">Kitap Ara</h1>
            <div style="margin-bottom:20%"></div>
            <span class="d-block mb-5 caption" data-aos="fade-up" data-aos-delay="300"style="font-family:Segoe UI Symbol;">Kitap ISBN'si Veya Kitap Adı
              Giriniz</span>
              <div style="margin-bottom:25%"></div>
            <input class="d-block mb-5 caption" type="text" style="color:black" data-aos="fade-up" data-aos-delay="300"
              name="queryvar" id="bookSearch" placeholder="Ad veya ISBN" required>
              <div style="margin-bottom:12%;margin-top: 0%"></div>
            <button class="btn-custom" data-aos="fade-up" data-aos-delay="400" id="submitButton"
              type="submit"><span style="font-family:Segoe UI Symbol;">Kitap Ara</span></button>
          </form>
        </div>
      </div>
      <div class="row align-items-center"
        style="margin: 0px; padding:0px;position: absolute;left:30%;padding-bottom: 10%;height: 60%">
        <div class="col-md-10" style="margin-top: 18%;">
          <form id="assignBook" method="POST" action="/assignBook" enctype="multipart/form-data">
            <h1 class="d-block mb-4" data-aos="fade-up" data-aos-delay="200" style="font-family:Segoe UI Symbol;">Kitap Al</h1>
            <div style="margin-bottom:23%"></div>
            <span class="d-block mb-5 caption" data-aos="fade-up" data-aos-delay="300"
              style="font-family:Segoe UI Symbol;padding-top: 0%;margin-top: 0%">Kitap ISBN'si Veya Kitap Adı Giriniz</span>
            <div style="margin-bottom:20%"></div>
            <input class="d-block mb-5 caption" style="color:black" data-aos="fade-up" data-aos-delay="300" type="text"
              name="bookInfo" id="bookAssign" placeholder="Ad veya ISBN" required>
            <div style="margin-bottom:15%;margin-top: 0%"></div>
            <button id="submitButton" type="submit" class="btn-custom" data-aos="fade-up"
              data-aos-delay="400"><span style="font-family:Segoe UI Symbol;">Kitap Al</span></button>
            <!--<a href="#" class="btn-custom" data-aos="fade-up" data-aos-delay="400"><span>Kitap Ara</span></a>-->
            <div style="padding-top: 0%"></div>
          </form>
        </div>
      </div>
      <div class="row align-items-center"
        style="margin: 0px; padding:0px;position: absolute;left:60%;padding-bottom: 10%;height: 60%;width:35%;">
        <div class="col-md-10" style="margin-top: 12%">
          <form id="userIsbnUploadForm" method="POST" action="/return" enctype="multipart/form-data">
            <h1 class="d-block mb-4" data-aos="fade-up" data-aos-delay="200" style="font-family:Segoe UI Symbol;">Kitap Ver</h1>
            <div style="margin-bottom:15%"></div>
            <span class="d-block mb-5 caption" data-aos="fade-up" data-aos-delay="300"
              style="padding-top: 0%;margin-top: 0%;font-family:Segoe UI Symbol;">Kitabın ISBN Fotoğrafını Yükleyiniz</span>
            <div style="margin-bottom:25%"></div>
            <input type="file" name="returnBookImage" class="custom-file-input" id="returnImageInput" class="d-block mb-5 caption" style="color:orange;" data-aos="fade-up" data-aos-delay="300" required single>
            <div style="margin-bottom:10%;margin-top: 11%"></div>
            <button type="submit" class="btn-custom" data-aos="fade-up" data-aos-delay="400"><span style="font-family:Segoe UI Symbol;">Kitap Ver</span></button>
            <!--<a href="#" class="btn-custom" data-aos="fade-up" data-aos-delay="400"><span>Kitap Ver</span></a>-->
            <div style="padding-top: 0%"></div>
          </form>
          <!--<span class="d-block mb-3 caption" data-aos="fade-up" data-aos-delay="100">AMINİGİ 2019</span>-->
        </div>
      </div>
    </div>
  </div>

  <script src="adminUserPage/js/jquery-3.3.1.min.js"></script>
  <script src="adminUserPage/js/jquery-migrate-3.0.1.min.js"></script>
  <script src="adminUserPage/js/jquery-ui.js"></script>
  <script src="adminUserPage/js/popper.min.js"></script>
  <script src="adminUserPage/js/bootstrap.min.js"></script>
  <script src="adminUserPage/js/owl.carousel.min.js"></script>
  <script src="adminUserPage/js/jquery.stellar.min.js"></script>
  <script src="adminUserPage/js/jquery.countdown.min.js"></script>
  <script src="adminUserPage/js/jquery.magnific-popup.min.js"></script>
  <script src="adminUserPage/js/bootstrap-datepicker.min.js"></script>
  <script src="adminUserPage/js/aos.js"></script>

  <script src="adminUserPage/js/main.js"></script>
  <script>
    //Load Username
    document.addEventListener('DOMContentLoaded', loadUserName);
    function loadUserName(){
      console.log("called");
      var xhr = new XMLHttpRequest();
      xhr.open('GET', '/getUserName', true);
      xhr.onload = async function () {
        if (this.status == 200) {
          let element = document.getElementById("addUserName");
          let userName = await JSON.parse(this.responseText);
          element.innerHTML = "Sayfası("+userName+")";
          console.log(userName);
        }
      }
      xhr.send();
    }
    
    //Upload Image
    document.getElementById("userIsbnUploadForm").addEventListener('submit', imageUpload);
    function imageUpload(e){
      e.preventDefault();
      let imageFile = document.getElementById("returnImageInput");
      console.log("tttttt:" + imageFile.files[0]);
      const xhr = new XMLHttpRequest();
      const formData = new FormData();
      xhr.onload = function(){
        let result = JSON.parse(this.responseText);
        if(result == "0"){
          alert("Bu kitaba sahip değilsiniz!");
        }else if(result == "1"){ 
          alert("Kitap kütüphaneye iade edildi!");
        }else{
          alert("Bilinmeyen");
        }
      }
      formData.append("returnBookImage",imageFile.files[0]);
      xhr.open('POST', '/return', true);
      xhr.send(formData);
    }

    //Book Search  document.getElementById('submitButton').addEventListener('click', getBookInfo);
    document.getElementById('userSearch').addEventListener('submit', getBookInfo);
    function getBookInfo(e){
      e.preventDefault();
        let bookInfo = document.getElementById("bookSearch").value;
        let param = 'queryvar='+bookInfo;
        bookInfo.value = "";
        //console.log(param);
        let xhr = new XMLHttpRequest();
        xhr.open('POST', '/userSearch', true);
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.onload = function(){
          let result = JSON.parse(this.responseText);
          console.log("RES!: "+result);
          if(result == ""){
            alert("Aradığınız kitap bulunamadı!");
          }else{
            alert("Aradığınız kitap kütüphanede mevcut!\Kitap Adı:"+result.bookname+ "\nISBN:" +" "+result.isbn);
          }
          
        }
        xhr.send(param);
    }

    //Request Book
    document.getElementById('assignBook').addEventListener('submit', getBook);
    function getBook(e){
      e.preventDefault();
        let bookInfo = document.getElementById("bookAssign").value;
        let param = 'bookInfo='+bookInfo;
        bookInfo.value = "";
        let xhr = new XMLHttpRequest();
        xhr.open('POST', '/assignBook', true);
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.onload = function(){
          let result = JSON.parse(this.responseText);
          console.log("RES!: "+result.hasMoreThanThreeBooks,result.hasOutOfDateBook,result.someOneHasBook);
          let message = "";
          if(result.hasMoreThanThreeBooks){
              message += "3 kitaba sahipsiniz! Daha fazla kitap alamazsnız.\n";
          }if(result.hasOutOfDateBook){
              message += "İade tarihi geçmiş kitap veya kitaplarınız var! Kitapları iade ediniz.\n";
          }if(result.someOneHasBook){
              message += "Kitap başkası tarafından alınmış!";
          }
          if(result == ""){
            alert("Aradığınız kitap bulunamadı!");
          }else if(result == "error"){
            alert("Kitabı ararken bir şeyler ters gitti!");
          }else{
            alert("Kitap envanterinize eklendi!");
          }
        }
        xhr.send(param);
    }
  </script>
</body>

</html>